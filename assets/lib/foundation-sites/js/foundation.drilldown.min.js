!function(n,e){"use strict";function i(t,o){this.$element=t,this.options=n.extend({},i.defaults,this.$element.data(),o),e.Nest.Feather(this.$element,"drilldown"),this._init(),e.registerPlugin(this,"Drilldown"),e.Keyboard.register("Drilldown",{ENTER:"open",SPACE:"open",ARROW_RIGHT:"next",ARROW_UP:"up",ARROW_DOWN:"down",ARROW_LEFT:"previous",ESCAPE:"close",TAB:"down",SHIFT_TAB:"up"})}i.defaults={backButton:'<li class="js-drilldown-back"><a>Back</a></li>',wrapper:"<div></div>",closeOnClick:!1},i.prototype._init=function(){this.$submenuAnchors=this.$element.find("li.is-drilldown-submenu-parent"),this.$submenus=this.$submenuAnchors.children("[data-submenu]"),this.$menuItems=this.$element.find("li").not(".js-drilldown-back").attr("role","menuitem"),this._prepareMenu(),this._keyboardEvents()},i.prototype._prepareMenu=function(){var e=this;this.$submenuAnchors.each(function(){var i=n(this),t=i.find("a:first");t.data("savedHref",t.attr("href")).removeAttr("href"),i.children("[data-submenu]").attr({"aria-hidden":!0,tabindex:0,role:"menu"}),e._events(i)}),this.$submenus.each(function(){var i=n(this),t=i.find(".js-drilldown-back");t.length||i.prepend(e.options.backButton),e._back(i)}),this.$element.parent().hasClass("is-drilldown")||(this.$wrapper=n(this.options.wrapper).addClass("is-drilldown").css(this._getMaxDims()),this.$element.wrap(this.$wrapper))},i.prototype._events=function(e){var i=this;e.off("click.zf.drilldown").on("click.zf.drilldown",function(t){if(n(t.target).parentsUntil("ul","li").hasClass("is-drilldown-submenu-parent")&&(t.stopImmediatePropagation(),t.preventDefault()),i._show(e),i.options.closeOnClick){var o=n("body").not(i.$wrapper);o.off(".zf.drilldown").on("click.zf.drilldown",function(n){n.preventDefault(),i._hideAll(),o.off(".zf.drilldown")})}})},i.prototype._keyboardEvents=function(){var i=this;this.$menuItems.add(this.$element.find(".js-drilldown-back")).on("keydown.zf.drilldown",function(t){var o,s,l=n(this),r=l.parent("ul").children("li");r.each(function(e){return n(this).is(l)?(o=r.eq(Math.max(0,e-1)),void(s=r.eq(Math.min(e+1,r.length-1)))):void 0}),e.Keyboard.handleKey(t,"Drilldown",{next:function(){l.is(i.$submenuAnchors)&&(i._show(l),l.on(e.transitionend(l),function(){l.find("ul li").filter(i.$menuItems).first().focus()}))},previous:function(){i._hide(l.parent("ul")),l.parent("ul").on(e.transitionend(l),function(){setTimeout(function(){l.parent("ul").parent("li").focus()},1)})},up:function(){o.focus()},down:function(){s.focus()},close:function(){i._back()},open:function(){l.is(i.$menuItems)?l.is(i.$submenuAnchors)&&(i._show(l),setTimeout(function(){l.find("ul li").filter(i.$menuItems).first().focus()},1)):(i._hide(l.parent("ul")),setTimeout(function(){l.parent("ul").parent("li").focus()},1))},handled:function(){t.preventDefault(),t.stopImmediatePropagation()}})})},i.prototype._hideAll=function(){var n=this.$element.find(".is-drilldown-submenu.is-active").addClass("is-closing");n.one(e.transitionend(n),function(e){n.removeClass("is-active is-closing")}),this.$element.trigger("closed.zf.drilldown")},i.prototype._back=function(n){var e=this;n.off("click.zf.drilldown"),n.children(".js-drilldown-back").on("click.zf.drilldown",function(i){i.stopImmediatePropagation(),e._hide(n)})},i.prototype._menuLinkEvents=function(){var n=this;this.$menuItems.not(".is-drilldown-submenu-parent").off("click.zf.drilldown").on("click.zf.drilldown",function(e){setTimeout(function(){n._hideAll()},0)})},i.prototype._show=function(n){n.children("[data-submenu]").addClass("is-active"),this.$element.trigger("open.zf.drilldown",[n])},i.prototype._hide=function(n){n.addClass("is-closing").one(e.transitionend(n),function(){n.removeClass("is-active is-closing")}),n.trigger("hide.zf.drilldown",[n])},i.prototype._getMaxDims=function(){var e=0,i={};return this.$submenus.add(this.$element).each(function(){var i=n(this).children("li").length;e=i>e?i:e}),i.height=e*this.$menuItems[0].getBoundingClientRect().height+"px",i.width=this.$element[0].getBoundingClientRect().width+"px",i},i.prototype.destroy=function(){this._hideAll(),e.Nest.Burn(this.$element,"drilldown"),this.$element.unwrap().find(".js-drilldown-back").remove().end().find(".is-active, .is-closing, .is-drilldown-submenu").removeClass("is-active is-closing is-drilldown-submenu").end().find("[data-submenu]").removeAttr("aria-hidden tabindex role").off(".zf.drilldown").end().off("zf.drilldown"),this.$element.find("a").each(function(){var e=n(this);e.data("savedHref")&&e.attr("href",e.data("savedHref")).removeData("savedHref")}),e.unregisterPlugin(this)},e.plugin(i,"Drilldown")}(jQuery,window.Foundation);